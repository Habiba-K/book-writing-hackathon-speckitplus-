# Data Model: Frontend RAG Integration

**Feature**: 006-frontend-rag-integration
**Date**: 2025-12-17

## Core Entities

### QueryRequest
**Description**: Request payload sent from frontend to backend
**Fields**:
- query: string - The user's natural language question
- top_k: integer - Number of results to retrieve (optional, defaults to 5)

### QueryResponse
**Description**: Response payload returned from backend to frontend
**Fields**:
- answer: string - The contextual answer generated by the agent
- sources: array of Source - List of sources used to generate the answer
- matched_chunks: array of Chunk - Content chunks retrieved from Qdrant
- query_time: float - Time taken to process the request (in seconds)
- success: boolean - Whether the operation was successful
- error: string - Error message if success is false (optional)

### Source
**Description**: Reference to the original document or location of retrieved information
**Fields**:
- url: string - URL or identifier of the source document
- title: string - Title of the source document
- chunk_index: integer - Index position of the chunk within the source

### Chunk
**Description**: Content chunk retrieved from Qdrant that matches the query semantically
**Fields**:
- text: string - The actual text content of the chunk
- similarity_score: float - How closely this chunk matches the query (0.0-1.0)
- source: Source - Reference to the original source document

### ChatMessage
**Description**: Individual message in the chat interface
**Fields**:
- id: string - Unique identifier for the message
- content: string - The text content of the message
- role: string - 'user' or 'assistant'
- timestamp: datetime - When the message was created
- sources: array of Source - Sources associated with assistant responses (optional)

### ChatState
**Description**: State of the chat interface
**Fields**:
- messages: array of ChatMessage - All messages in the current chat session
- isLoading: boolean - Whether a response is currently being generated
- error: string - Current error state if any
- isOpen: boolean - Whether the chat window is open

## Relationships

- QueryRequest generates one QueryResponse
- QueryResponse contains many Source objects (via sources field)
- QueryResponse contains many Chunk objects (via matched_chunks field)
- Chunk is associated with one Source (via source field)
- ChatState contains many ChatMessage objects (via messages field)
- ChatMessage may contain many Source objects (via sources field) for assistant responses

## Validation Rules

### QueryRequest Validation
- query must not be empty or contain only whitespace
- query length must be within reasonable limits (e.g., max 2000 characters)
- top_k must be between 1 and 20 if provided

### QueryResponse Validation
- answer must be provided when success is true
- sources and matched_chunks must be provided when success is true
- query_time must be a positive number
- success must be a boolean value

### Source Validation
- url must be a valid URL format
- title must not be empty
- chunk_index must be a non-negative integer

### Chunk Validation
- text must not be empty
- similarity_score must be between 0.0 and 1.0
- source must be a valid Source object

### ChatMessage Validation
- content must not be empty
- role must be either 'user' or 'assistant'
- timestamp must be a valid datetime

## State Transitions

### Chat Interface States
1. **Closed**: Chat window is hidden, only the floating button is visible
2. **Opened**: Chat window is visible, ready to accept user input
3. **Submitting**: User has submitted a query, waiting for response
4. **Loading**: Backend is processing the query
5. **Response Ready**: Response has been received and displayed
6. **Error**: An error occurred during the process

## Data Flow

1. User types a query in the chat interface
2. Frontend sends QueryRequest to backend /ask endpoint
3. Backend processes the query using the RAG agent
4. Backend returns QueryResponse with answer, sources, and matched chunks
5. Frontend formats the response into ChatMessage objects
6. Frontend updates ChatState to display the response
7. User can continue the conversation with follow-up queries